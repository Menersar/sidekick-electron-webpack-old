{"version":3,"names":["_chalk","data","_interopRequireDefault","require","obj","__esModule","default","filterText","s","lineFilter","lines","trim","split","filter","it","includes","length","join","logProcessErrorOutput","label","childProcess","stderr","on","logProcess","toString","chalk","red","logError","error","stack","LABEL_LENGTH","labelColor","log","process","stdout","write","bold","repeat","DelayedFunction","constructor","executor","handle","schedule","cancel","setTimeout","clearTimeout","exports","getCommonEnv","Object","assign","env","NODE_ENV","DEBUG_COLORS","DEBUG_FD"],"sources":["../../src/dev/devUtil.ts"],"sourcesContent":["import chalk from \"chalk\"\r\nimport { ChildProcess } from \"child_process\"\r\n\r\nexport interface LineFilter {\r\n  filter(line: string): boolean\r\n}\r\n\r\nfunction filterText(s: string, lineFilter: LineFilter | null) {\r\n  const lines = s\r\n    .trim()\r\n    .split(/\\r?\\n/)\r\n    .filter(it => {\r\n      if (lineFilter != null && !lineFilter.filter(it)) {\r\n        return false\r\n      }\r\n\r\n      // https://github.com/electron/electron/issues/4420\r\n      // this warning can be safely ignored\r\n      if (it.includes(\"Couldn't set selectedTextBackgroundColor from default ()\")) {\r\n        return false\r\n      }\r\n      if (it.includes(\"Use NSWindow's -titlebarAppearsTransparent=YES instead.\")) {\r\n        return false\r\n      }\r\n      return !it.includes(\"Warning: This is an experimental feature and could change at any time.\")\r\n        && !it.includes(\"No type errors found\")\r\n        && !it.includes(\"webpack: Compiled successfully.\")\r\n    })\r\n\r\n  if (lines.length === 0) {\r\n    return null\r\n  }\r\n  return \"  \" + lines.join(`\\n  `) + \"\\n\"\r\n}\r\n\r\nexport function logProcessErrorOutput(label: \"Electron\" | \"Renderer\" | \"Main\", childProcess: ChildProcess) {\r\n  childProcess.stderr!!.on(\"data\", data => {\r\n    logProcess(label, data.toString(), chalk.red)\r\n  })\r\n}\r\n\r\nexport function logError(label: \"Electron\" | \"Renderer\" | \"Main\", error: Error) {\r\n  logProcess(label, error.stack || error.toString(), chalk.red)\r\n}\r\n\r\nconst LABEL_LENGTH = 28\r\n\r\nexport function logProcess(label: \"Electron\" | \"Renderer\" | \"Main\", data: string | Buffer, labelColor: any, lineFilter: LineFilter | null = null) {\r\n  const log = filterText(data.toString(), lineFilter)\r\n  if (log == null || log.length === 0) {\r\n    return\r\n  }\r\n\r\n  process.stdout.write(\r\n    labelColor.bold(`┏ ${label} ${\"-\".repeat(LABEL_LENGTH - label.length - 1)}`) +\r\n    \"\\n\\n\" + log + \"\\n\" +\r\n    labelColor.bold(`┗ ${\"-\".repeat(LABEL_LENGTH)}`) +\r\n    \"\\n\"\r\n  )\r\n}\r\n\r\nexport class DelayedFunction {\r\n  private readonly executor: () => void\r\n  private handle: NodeJS.Timer | null = null\r\n\r\n  constructor(executor: () => void) {\r\n    this.executor = () => {\r\n      this.handle = null\r\n      executor()\r\n    }\r\n  }\r\n\r\n  schedule() {\r\n    this.cancel()\r\n    this.handle = setTimeout(this.executor, 5000)\r\n  }\r\n\r\n  cancel() {\r\n    const handle = this.handle\r\n    if (handle != null) {\r\n      this.handle = null\r\n      clearTimeout(handle)\r\n    }\r\n  }\r\n}\r\n\r\nexport function getCommonEnv() {\r\n  return {\r\n    ...process.env,\r\n    NODE_ENV: \"development\",\r\n    // to force debug colors in the child process\r\n    DEBUG_COLORS: true,\r\n    DEBUG_FD: \"1\",\r\n  }\r\n}"],"mappings":"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"}

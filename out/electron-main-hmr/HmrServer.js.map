{"version":3,"names":["_crocket","data","_interopRequireDefault","require","obj","__esModule","default","debug","HmrServer","constructor","state","ipc","Crocket","listen","Promise","resolve","reject","socketPath","process","pid","toString","path","error","enabled","beforeCompile","built","stats","setImmediate","hash","toJson","assets","chunks","children","modules","emit"],"sources":["../../src/electron-main-hmr/HmrServer.ts"],"sourcesContent":["import Crocket from \"crocket\"\r\nimport { Stats } from \"webpack\"\r\n\r\nconst debug = require(\"debug\")(\"electron-webpack:dev-runner\")\r\n\r\nexport class HmrServer {\r\n  private state = false\r\n  readonly ipc = new Crocket()\r\n\r\n  listen(): Promise<string> {\r\n    return new Promise((resolve, reject) => {\r\n      const socketPath = `/tmp/electron-main-ipc-${process.pid.toString(16)}.sock`\r\n      this.ipc.listen({path: socketPath}, error => {\r\n        if (error != null) {\r\n          reject(error)\r\n        }\r\n        if (debug.enabled) {\r\n          debug(`HMR Server listening on ${socketPath}`)\r\n        }\r\n        resolve(socketPath)\r\n      })\r\n    })\r\n  }\r\n\r\n  beforeCompile() {\r\n    this.state = false\r\n  }\r\n\r\n  built(stats: Stats): void {\r\n    this.state = true\r\n    setImmediate(() => {\r\n      if (!this.state) {\r\n        return\r\n      }\r\n\r\n      const hash = stats.toJson({assets: false, chunks: false, children: false, modules: false}).hash\r\n      if (debug.enabled) {\r\n        debug(`Send built: hash ${hash}`)\r\n      }\r\n      this.ipc.emit(\"/built\", {hash})\r\n    })\r\n  }\r\n}"],"mappings":";;;;;;AAAA,SAAAA,SAAA;EAAA,MAAAC,IAAA,GAAAC,sBAAA,CAAAC,OAAA;EAAAH,QAAA,YAAAA,CAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAA6B,SAAAC,uBAAAE,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAG7B,MAAMG,KAAK,GAAGJ,OAAO,CAAC,OAAO,CAAC,CAAC,6BAA6B,CAAC;AAEvD,MAAOK,SAAS;EAAtBC,YAAA;IACU,KAAAC,KAAK,GAAG,KAAK;IACZ,KAAAC,GAAG,GAAG,KAAIC,kBAAO,GAAE;EAmC9B;EAjCEC,MAAMA,CAAA;IACJ,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAI;MACrC,MAAMC,UAAU,GAAG,0BAA0BC,OAAO,CAACC,GAAG,CAACC,QAAQ,CAAC,EAAE,CAAC,OAAO;MAC5E,IAAI,CAACT,GAAG,CAACE,MAAM,CAAC;QAACQ,IAAI,EAAEJ;MAAU,CAAC,EAAEK,KAAK,IAAG;QAC1C,IAAIA,KAAK,IAAI,IAAI,EAAE;UACjBN,MAAM,CAACM,KAAK,CAAC;;QAEf,IAAIf,KAAK,CAACgB,OAAO,EAAE;UACjBhB,KAAK,CAAC,2BAA2BU,UAAU,EAAE,CAAC;;QAEhDF,OAAO,CAACE,UAAU,CAAC;MACrB,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ;EAEAO,aAAaA,CAAA;IACX,IAAI,CAACd,KAAK,GAAG,KAAK;EACpB;EAEAe,KAAKA,CAACC,KAAY;IAChB,IAAI,CAAChB,KAAK,GAAG,IAAI;IACjBiB,YAAY,CAAC,MAAK;MAChB,IAAI,CAAC,IAAI,CAACjB,KAAK,EAAE;QACf;;MAGF,MAAMkB,IAAI,GAAGF,KAAK,CAACG,MAAM,CAAC;QAACC,MAAM,EAAE,KAAK;QAAEC,MAAM,EAAE,KAAK;QAAEC,QAAQ,EAAE,KAAK;QAAEC,OAAO,EAAE;MAAK,CAAC,CAAC,CAACL,IAAI;MAC/F,IAAIrB,KAAK,CAACgB,OAAO,EAAE;QACjBhB,KAAK,CAAC,oBAAoBqB,IAAI,EAAE,CAAC;;MAEnC,IAAI,CAACjB,GAAG,CAACuB,IAAI,CAAC,QAAQ,EAAE;QAACN;MAAI,CAAC,CAAC;IACjC,CAAC,CAAC;EACJ"}

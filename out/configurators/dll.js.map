{"version":3,"names":["_fsExtra","data","require","path","_interopRequireWildcard","_webpack","_util","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","configureDll","configurator","dllManifest","projectDir","type","dll","electronWebpackConfiguration","renderer","Error","config","entry","Array","isArray","vendor","join","commonDistDirectory","plugins","push","DllPlugin","name","context","output","libraryTarget","library","dllDir","dirStat","statOrNull","isDirectory","debug","DllReferencePlugin","manifest","readJson","getDllAssets","files","orNullIfFileNotExist","readdir","filter","it","endsWith","sort"],"sources":["../../src/configurators/dll.ts"],"sourcesContent":["import { readdir, readJson } from \"fs-extra\"\r\nimport * as path from \"path\"\r\nimport { DllPlugin, DllReferencePlugin } from \"webpack\"\r\nimport { WebpackConfigurator } from \"../main\"\r\nimport { orNullIfFileNotExist, statOrNull } from \"../util\"\r\n\r\nexport async function configureDll(configurator: WebpackConfigurator): Promise<string | null> {\r\n  let dllManifest: string | null = null\r\n  const projectDir = configurator.projectDir\r\n\r\n  if (configurator.type === \"renderer-dll\") {\r\n    const dll = configurator.electronWebpackConfiguration.renderer!!.dll\r\n    if (dll == null) {\r\n      throw new Error(`renderer-dll requires DLL configuration`)\r\n    }\r\n\r\n    configurator.config.entry = Array.isArray(dll) ? {vendor: dll} : dll\r\n\r\n    dllManifest = path.join(configurator.commonDistDirectory, configurator.type, \"manifest.json\")\r\n    configurator.plugins.push(new DllPlugin({\r\n      name: \"[name]\",\r\n      path: dllManifest,\r\n      context: projectDir,\r\n    }))\r\n\r\n    const output = configurator.config.output!\r\n    // leave as default \"var\"\r\n    delete output.libraryTarget\r\n    output.library = \"[name]\"\r\n  }\r\n  else if (configurator.type === \"renderer\") {\r\n    const dllDir = path.join(configurator.commonDistDirectory, \"renderer-dll\")\r\n    const dirStat = await statOrNull(dllDir)\r\n    if (dirStat == null || !dirStat.isDirectory()) {\r\n      configurator.debug(\"No DLL directory\")\r\n      return null\r\n    }\r\n\r\n    configurator.debug(`DLL directory: ${dllDir}`)\r\n    configurator.plugins.push(new DllReferencePlugin({\r\n      context: projectDir,\r\n      manifest: await readJson(path.join(dllDir, \"manifest.json\")),\r\n    }))\r\n  }\r\n\r\n  return dllManifest\r\n}\r\n\r\nexport async function getDllAssets(dllDir: string, configurator: WebpackConfigurator) {\r\n  if (configurator.electronWebpackConfiguration.renderer!!.dll == null) {\r\n    return []\r\n  }\r\n\r\n  const files = await orNullIfFileNotExist(readdir(dllDir))\r\n  return files == null ? [] : files.filter(it => it.endsWith(\".js\") || it.endsWith(\".css\")).sort()\r\n}"],"mappings":"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"}
